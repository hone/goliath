#!/usr/bin/env ruby

$: << File.expand_path(File.dirname(File.realpath(__FILE__)) + '/../lib')
require 'bundler/setup'
require 'thor'

module Goliath
  class CLI < Thor
    desc "download VOD_URL", "Download Twitch VOD"
    option :output,
      desc: "Output file of the VOD.",
      type: :string,
      required: true
    def download(vod_id)
      require 'goliath/vod_cutter'
      require 'goliath/downloader'
      require 'goliath/joiner'

      FileUtils.mkdir_p(vod_id)
      Dir.chdir(vod_id) do
        links = VodCutter.new.fetch(vod_id: vod_id)

        parts_dir = "parts"
        FileUtils.mkdir_p(parts_dir)
        Dir.chdir(parts_dir) { Downloader.new.run(links) }
        Joiner.new.build(options[:output])
        puts "Built #{vod_id}/#{options[:output]}"
      end
    end
  end
end

Goliath::CLI.start(ARGV)
